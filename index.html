<script>
    // ... 前段代碼保持不變 ...
    let allTrips = JSON.parse(localStorage.getItem('TravelTiramisu_V15')) || [];

    function showDetail(index) {
        try {
            currentTripIndex = index;
            // 先切換畫面，確保使用者看到反應
            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-detail').classList.remove('hidden');
            // 再執行渲染
            renderTripDetail();
        } catch (err) {
            console.error("進入詳情頁出錯:", err);
            // 即使報錯也強制顯示詳情頁面結構
            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-detail').classList.remove('hidden');
        }
    }

    // 修正 renderTripDetail，避免因為資料空缺導致渲染中斷
    function renderTripDetail() {
        const trip = allTrips[currentTripIndex];
        if (!trip) return goHome();

        document.getElementById('currentTripTitle').innerText = trip.name || "My Trip";
        
        // 渲染天數標籤
        const daySelector = document.getElementById('daySelector');
        if (trip.dailyItinerary) {
            daySelector.innerHTML = trip.dailyItinerary.map((d, i) => {
                const dateObj = new Date(d.date);
                return `<button onclick="selectedDayIndex=${i}; renderTripDetail()" class="day-tab flex-shrink-0 min-w-[75px] p-3 rounded-2xl text-center ${selectedDayIndex === i ? 'active' : ''}">
                    <div class="text-[10px] opacity-70 mb-1">${['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'][dateObj.getDay()]}</div>
                    <div class="text-base font-bold">${d.date.substring(5).replace('-', '/')}</div>
                </button>`;
            }).join('');
        }

        // 渲染行程項目
        renderItineraryItems(trip);
        updateTotal(); // 更新帳務
    }
    // ... 後續函式保持不變 ...
</script>
